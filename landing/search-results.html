<!DOCTYPE html>
<!-- NextApp - App Landing Page Template design by DSAThemes (http://www.dsathemes.com) -->
<!--[if lt IE 7 ]><html class="ie ie6" lang="en"> <![endif]-->
<!--[if IE 7 ]><html class="ie ie7" lang="en"> <![endif]-->
<!--[if IE 8 ]><html class="ie ie8" lang="en"> <![endif]-->
<!--[if (gte IE 9)|!(IE)]><!-->
<html lang="en">



<head>



		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
		<meta name="author" content="DSAThemes"/>
		<meta name="description" content="NextApp - Mobile App Landing Page Template"/>
		<meta name="keywords" content="Responsive, HTML5 template, DSAThemes, Mobile, Application, One Page, Landing, Mobile App">
		<meta name="viewport" content="width=device-width, initial-scale=1.0"/>

  		<!-- SITE TITLE -->
		<title>NextApp - App Landing Page Template</title>

		<!-- FAVICON AND TOUCH ICONS  -->
		<link rel="shortcut icon" href="images/favicon.ico" type="image/x-icon">
		<link rel="icon" href="images/favicon.ico" type="image/x-icon">
		<link rel="apple-touch-icon" sizes="152x152" href="images/apple-touch-icon-152x152.png">
		<link rel="apple-touch-icon" sizes="120x120" href="images/apple-touch-icon-120x120.png">
		<link rel="apple-touch-icon" sizes="76x76" href="images/apple-touch-icon-76x76.png">
		<link rel="apple-touch-icon" href="images/apple-touch-icon.png">

		<!-- GOOGLE FONTS -->
		<link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700,900" rel="stylesheet">
		<link href="https://fonts.googleapis.com/css?family=Noto+Sans+TC:300,400,500,700,900" rel="stylesheet">

		<!-- BOOTSTRAP CSS -->
		<link href="css/bootstrap.min.css" rel="stylesheet">

		<!-- FONT ICONS -->
		<link href="css/fontawesome.min.css" rel="stylesheet">
		<link href="css/flaticon.css" rel="stylesheet">

		<!-- PLUGINS STYLESHEET -->
		<link href="css/magnific-popup.css" rel="stylesheet">
		<link href="css/owl.carousel.min.css" rel="stylesheet">
		<link href="css/owl.theme.default.min.css" rel="stylesheet">
		<link href="css/slick.css" rel="stylesheet">
		<link href="css/slick-theme.css" rel="stylesheet">

		<!-- On Scroll Animations -->
		<link href="css/animate.css" rel="stylesheet">

		<!-- TEMPLATE CSS -->
		<link href="css/spinner.css" rel="stylesheet">
		<link href="css/style.css" rel="stylesheet">

		<!-- RESPONSIVE CSS -->
		<link href="css/responsive.css" rel="stylesheet">



	</head>



	<body>



		<!-- PRELOADER SPINNER
		============================================= -->
		<div id="loader-wrapper">
			<div id="loader">
				<div class="cssload-spinner"></div>
			</div>
		</div>




		<!-- PAGE CONTENT
		============================================= -->
		<div id="page" class="page">




			<!-- HEADER
			============================================= -->
			<header id="header" class="header">
				<nav class="navbar fixed-top navbar-expand-md hover-menu navbar-light bg-tra black-scroll">
					<div class="container">


						<!-- LOGO IMAGE -->
						<!-- For Retina Ready displays take a image with double the amount of pixels that your image will be displayed (e.g 240 x 60 pixels) -->
				 		<a href="#hero-8" class="navbar-brand logo-black"><img src="images/logo.png" width="120" height="30" alt="header-logo"></a>
				 		<a href="#hero-8" class="navbar-brand logo-white"><img src="images/logo-white.png" width="120" height="30" alt="header-logo"></a>


				 		<!-- Responsive Menu Button -->
				 		<button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarContent" aria-controls="navbarContent" aria-expanded="false" aria-label="Toggle navigation">
				   		 	<span class="navbar-bar-icon"><i class="fas fa-bars"></i></span>
				  		</button>


				  		<!-- Navigation Menu -->
				  		<div id="navbarContent" class="collapse navbar-collapse">
					   		<ul class="navbar-nav ml-auto">


                  									<!--
                                        			<li class="nav-item dropdown">
                  		                            <a class="nav-link dropdown-toggle" href="#" id="DropdownMenu" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                  		                                Products
                  		                            </a>


                                             			<ul class="dropdown-menu" aria-labelledby="DropdownMenu">
                                             				<li><a class="dropdown-item" href="#info-5">Electronics</a></li>
                                             				<li><a class="dropdown-item" href="#process-2">Software</a></li>
                                             				<li><a class="dropdown-item" href="#info-8">Clothing</a></li>
                  		                                <li><a class="dropdown-item" href="#reviews-3">Home & beauty</a></li>
                                              		</ul>
                                          		</li>
                  														-->

                  					     		<li class="nav-item nl-simple"><a class="nav-link" href="#features-2">Browse nearby discounts <br> <span style="font-size: 10px; opacity: 0.7;">Coming soon</span></a></li>
                  					     		<li class="nav-item nl-simple"><a class="nav-link" href="#pricing-2">About us </a></li>
                  							    <li class="nav-item nl-simple"><a class="nav-link" href="#blog-1">Stores</a></li>


							   <!-- AppStore Badge
								<li class="nav-item">
									<a href="#" class="header-store">
										<img class="appstore-header" src="images/store_badges/appstore.png" alt="appstore-logo">
									</a>
								</li>  -->

								<!-- Google Play Badge
								<li class="nav-item">
									<a href="#" class="header-store">
										<img class="googleplay-header" src="images/store_badges/googleplay.png" alt="googleplay-logo">
									</a>
								</li>  -->

					      	</ul>

					      	<!-- Header Button -->
					      	<span class="navbar-text white-color">

							</span>

					    </div>	<!-- End Navigation Menu -->


					</div>	  <!-- End container -->
				</nav>	   <!-- End navbar -->
			</header>	<!-- END HEADER -->




			<!-- HERO-8
			============================================= -->
			<section id="hero-8" class="hero-section division">
				<div class="container">
					<div class="row d-flex">


						<!-- HERO TEXT -->
						<div class="col-md-7 col-xl-6">
							<div class="hero-txt mb-40 wow fadeInUp" data-wow-delay="0.3s">

					 			<!-- Small Title -->

								<!-- SÃ¸gefelt -->
								<form class="newsletter-form">
									<div class="input-group">
										<input type="email" class="form-control" value="Macbook Pro 16" required="" name="EMAIL">
										<span class="input-group-btn">
											<button class="btn btn-black black-tra-hover" data-target="#exampleModal" >Search</button>
										</span>
									</div>
								</form>
								<!-- <input type="email" class="form-control" placeholder="Search and find discounts online and nearby" required="" id="s-email" name="EMAIL"> -->
								<!-- Modal -->

                <ul class="list-group" id="search_results" style="margin-top: 20px; padding-right: 20px; padding-left: 5px;">
				  
              </ul>
							</div>
						</div>	<!-- END HERO TEXT -->


						<!-- HERO IMAGE -->
						<div class="col-md-5 col-xl-6">
							<div class="hero-8-img mb-40 wow fadeInRight" data-wow-duration="1.5s" data-wow-delay="0.6s">
								<img class="img-fluid" src="images/hero-81-img.png" alt="hero-image">
							</div>
						</div>


					</div>	  <!-- End row -->
				</div>	   <!-- End container -->
			</section>	<!-- END HERO-8 -->








		<!-- EXTERNAL SCRIPTS
		============================================= -->
		<script src="js/jquery-3.3.1.min.js"></script>
		<script src="js/bootstrap.min.js"></script>
		<script src="js/fontawesome.min.js"></script>
		<script src="js/modernizr.custom.js"></script>
		<script src="js/jquery.easing.js"></script>
		<script src="js/retina.js"></script>
		<script src="js/jquery.appear.js"></script>
		<script src="js/jquery.stellar.min.js"></script>
		<script src="js/jquery.scrollto.js"></script>
		<script src="js/imagesloaded.pkgd.min.js"></script>
		<script src="js/isotope.pkgd.min.js"></script>
		<script src="js/slick.min.js"></script>
		<script src="js/owl.carousel.min.js"></script>
		<script src="js/jquery.magnific-popup.min.js"></script>
		<script src="js/contact-form.js"></script>
		<script src="js/quick-form.js"></script>
		<script src="js/comment-form.js"></script>
		<script src="js/jquery.validate.min.js"></script>
		<script src="js/jquery.ajaxchimp.min.js"></script>
		<script src="js/wow.js"></script>
		<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
		<!-- Custom Script -->
		<script src="js/custom.js"></script>

		<script>
			new WOW().init();
		</script>

		<script>
			function getUrlParameter(name) {
				name = name.replace(/[\[]/, '\\[').replace(/[\]]/, '\\]');
				var regex = new RegExp('[\\?&]' + name + '=([^&#]*)');
				var results = regex.exec(location.search);
				return results === null ? '' : decodeURIComponent(results[1].replace(/\+/g, ' '));
			};

			function sleep(milliseconds) {
			const date = Date.now();
			let currentDate = null;
			do {
				currentDate = Date.now();
			} while (currentDate - date < milliseconds);
			}

			$(document).ready(function(){
				console.log('started')
				let urlPricerunner = 'http://127.0.0.1:3333/search?query=' + getUrlParameter('query') + '&type=pricerunner';
				let urlGoogle = 'http://127.0.0.1:3333/search?query=' + getUrlParameter('query') + '&type=google_shopping';

				$.ajaxSetup({async:false});
				let dataPricerunner = JSON.parse($.get(urlPricerunner).responseText);
				let dataGoogle = JSON.parse($.get(urlGoogle).responseText);

				console.log('Got data..')
			
				console.log('Checking if download is ready...')
				let pricerunnerReady = false
				let googleReady = false
				while(pricerunnerReady == false){
					let urlReadyPricerunner = 'http://127.0.0.1:3333/search/status?id=' + dataPricerunner.job_id;
					let response = JSON.parse($.get(urlReadyPricerunner).responseText);
					console.log(response)
					if(response.status === "finished"){
						pricerunnerReady = true
						console.log('Pricerunner is ready!')
					} else {
					}
					sleep(500)
				}

				while(googleReady == false){
					let urlReadyGoogle = 'http://127.0.0.1:3333/search/status?id=' + dataGoogle.job_id;
					let response = JSON.parse($.get(urlReadyGoogle).responseText);
					console.log(response)
					if(response.status === "finished"){
						googleReady = true
						console.log('Google is ready!')
					} else {
					}
					sleep(500)
				}

				let pricerunnerDownloadUrl = 'http://127.0.0.1:3333/search/result?id=' + dataPricerunner.job_id;
				let pricerunnerData = JSON.parse($.get(pricerunnerDownloadUrl).responseText);;

				// Add to list group 
				pricerunnerData.results[0].content.search_results.map(item => {
					$("#search_results").append(`<li class="list-group-item" style="font-size: 14px;">${item.name}<a href="table/index.html" class="btn btn-green black-hover" style="float: right;"> ${item.min_price},-</a></li>`)
				})

				let googleDownloadUrl = 'http://127.0.0.1:3333/search/result?id=' + dataGoogle.job_id;
				let googleData = JSON.parse($.get(googleDownloadUrl).responseText);

				console.log('Results')
				console.log('GOOGLE')
				console.log(googleData)
				console.log('PRICERUNNER')
				console.log(pricerunnerData)
				
				googleData.results[0].content.search_results.map(item => {
					let price = ''
					show = false 
					if(item.hasOwnProperty('price')){
						price = item.price
						show = true 
					}

					if(item.hasOwnProperty('min_price')){
						price = item.min_price 
						show = true 
					}

					if (show == true){
						$("#search_results").append(`<li class="list-group-item" style="font-size: 14px;">${item.name}<a href="table/index.html" class="btn btn-green black-hover" style="float: right;"> ${price},-</a></li>`)
					}
					
				})

			




				
			});

			
		</script>

	</body>



</html>
